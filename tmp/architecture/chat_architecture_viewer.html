<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat System Architecture with MCP and RAG</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        header p {
            font-size: 1.2em;
            opacity: 0.95;
        }
        
        .content {
            padding: 40px;
        }
        
        .mermaid-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        .mermaid {
            display: flex;
            justify-content: center;
            min-height: 600px;
        }
        
        #markdown-content {
            line-height: 1.8;
        }
        
        #markdown-content h1 {
            color: #667eea;
            font-size: 2.2em;
            margin: 30px 0 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        #markdown-content h2 {
            color: #764ba2;
            font-size: 1.8em;
            margin: 25px 0 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        #markdown-content h3 {
            color: #555;
            font-size: 1.4em;
            margin: 20px 0 10px;
        }
        
        #markdown-content ul, #markdown-content ol {
            margin-left: 30px;
            margin-bottom: 15px;
        }
        
        #markdown-content li {
            margin: 8px 0;
        }
        
        #markdown-content p {
            margin: 15px 0;
            text-align: justify;
        }
        
        #markdown-content strong {
            color: #764ba2;
            font-weight: 600;
        }
        
        #markdown-content code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
        }
        
        .section {
            background: #f9f9f9;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        
        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .component-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .component-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        
        .component-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            border-top: 1px solid #e0e0e0;
        }
        
        .diagram-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: scale(1.05);
        }
        
        button:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Chat System Architecture</h1>
            <p>MCP Orchestration with RAG Integration and Tool Services</p>
        </header>
        
        <div class="content">
            <div class="diagram-controls">
                <button onclick="resetZoom()">Reset View</button>
                <button onclick="toggleDiagram()">Toggle Diagram</button>
            </div>
            
            <div class="mermaid-container" id="diagram-container">
                <div class="mermaid" id="mermaid-diagram">
graph TB
    subgraph "Client Layer"
        UI[Chat UI/Frontend]
        API[API Gateway]
    end

    subgraph "Orchestration Layer"
        MCP[MCP Orchestrator<br/>Decision Engine]
        Router[Request Router]
        Context[Context Manager]
    end

    subgraph "RAG Pipeline"
        Embedder[Text Embedder]
        VectorDB[(Vector Database<br/>Pinecone/Weaviate)]
        Retriever[Document Retriever]
        Reranker[Result Reranker]
    end

    subgraph "Tool Services"
        CodeTool[Code Analysis Tool]
        SearchTool[Web Search Tool]
        DBTool[Database Query Tool]
        FileTool[File System Tool]
        CalcTool[Calculator Tool]
        ImageTool[Image Processing Tool]
    end

    subgraph "Knowledge Sources"
        DocStore[(Document Store)]
        KnowledgeBase[(Knowledge Base)]
        CodeRepo[(Code Repository)]
        APIEndpoints[External APIs]
    end

    subgraph "LLM Services"
        MainLLM[Primary LLM<br/>GPT-4/Claude]
        SpecializedLLM[Specialized LLMs<br/>Code/Math/Vision]
        LocalLLM[Local LLM<br/>Llama/Mistral]
    end

    subgraph "Response Processing"
        ResponseGen[Response Generator]
        Validator[Response Validator]
        Cache[(Response Cache)]
    end

    %% Client to Orchestration
    UI --> API
    API --> MCP
    MCP --> Router
    Router --> Context

    %% MCP Decision Flow
    Context --> |Query Analysis| MCP
    MCP -->|RAG Required| Retriever
    MCP -->|Tool Required| CodeTool
    MCP -->|Tool Required| SearchTool
    MCP -->|Tool Required| DBTool
    MCP -->|Tool Required| FileTool
    MCP -->|Tool Required| CalcTool
    MCP -->|Tool Required| ImageTool

    %% RAG Pipeline Flow
    Retriever --> Embedder
    Embedder --> VectorDB
    VectorDB --> Reranker
    Reranker --> MainLLM

    %% Knowledge Source Connections
    DocStore --> Retriever
    KnowledgeBase --> Retriever
    CodeRepo --> CodeTool
    APIEndpoints --> SearchTool

    %% Tool to LLM Flow
    CodeTool --> SpecializedLLM
    SearchTool --> MainLLM
    DBTool --> MainLLM
    FileTool --> LocalLLM
    CalcTool --> SpecializedLLM
    ImageTool --> SpecializedLLM

    %% LLM to Response
    MainLLM --> ResponseGen
    SpecializedLLM --> ResponseGen
    LocalLLM --> ResponseGen
    ResponseGen --> Validator
    Validator --> Cache
    Cache --> API

    %% Styling
    classDef clientStyle fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef orchStyle fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef ragStyle fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef toolStyle fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px
    classDef knowledgeStyle fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef llmStyle fill:#f1f8e9,stroke:#33691e,stroke-width:2px
    classDef responseStyle fill:#e0f2f1,stroke:#004d40,stroke-width:2px

    class UI,API clientStyle
    class MCP,Router,Context orchStyle
    class Embedder,VectorDB,Retriever,Reranker ragStyle
    class CodeTool,SearchTool,DBTool,FileTool,CalcTool,ImageTool toolStyle
    class DocStore,KnowledgeBase,CodeRepo,APIEndpoints knowledgeStyle
    class MainLLM,SpecializedLLM,LocalLLM llmStyle
    class ResponseGen,Validator,Cache responseStyle
                </div>
            </div>
            
            <div id="markdown-content"></div>
        </div>
        
        <footer>
            <p>Interactive Architecture Diagram - MCP & RAG Integration</p>
        </footer>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                fontFamily: 'Arial, sans-serif'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        const markdownContent = `
## System Overview

This architecture demonstrates a modern chat system that leverages MCP (Model Context Protocol) as the central orchestrator for routing requests to appropriate services and tools, including RAG (Retrieval-Augmented Generation) capabilities.

<div class="section">
<h3>Key Architecture Principles</h3>
<ul>
<li><strong>Modularity</strong>: Each component has a single responsibility</li>
<li><strong>Scalability</strong>: Services can be scaled independently</li>
<li><strong>Flexibility</strong>: Easy to add new tools and capabilities</li>
<li><strong>Intelligence</strong>: MCP makes smart routing decisions</li>
</ul>
</div>

## Component Descriptions

<div class="component-grid">
<div class="component-card">
<h4>MCP Orchestrator</h4>
<p>The central decision engine that analyzes queries, determines which tools/services to invoke, manages RAG and tool-based responses, and coordinates multi-step workflows.</p>
</div>

<div class="component-card">
<h4>RAG Pipeline</h4>
<p>Handles knowledge retrieval through text embedding, vector database storage, document retrieval, and result reranking for optimal relevance.</p>
</div>

<div class="component-card">
<h4>Tool Services</h4>
<p>Specialized tools for code analysis, web search, database queries, file operations, calculations, and image processing.</p>
</div>

<div class="component-card">
<h4>LLM Services</h4>
<p>Multiple LLM options including primary models (GPT-4/Claude), specialized models for specific tasks, and local models for privacy-sensitive operations.</p>
</div>
</div>

## Response Flow

<div class="section">
<ol>
<li>User query enters through <strong>Chat UI</strong></li>
<li><strong>API Gateway</strong> forwards to MCP Orchestrator</li>
<li><strong>MCP</strong> analyzes query and decides on approach:
   <ul>
   <li>RAG for knowledge-based queries</li>
   <li>Tools for specific actions</li>
   <li>Direct LLM for general conversation</li>
   </ul>
</li>
<li>Selected services process the request</li>
<li>Response is generated, validated, and cached</li>
<li>Final response returned to user</li>
</ol>
</div>

## Key Features

- **Intelligent Routing**: MCP decides optimal path for each query
- **Hybrid Approach**: Combines RAG with tool-based responses  
- **Multi-LLM Support**: Different LLMs for different tasks
- **Caching**: Improves response time for repeated queries
- **Extensible**: Easy to add new tools and services
        `;

        document.getElementById('markdown-content').innerHTML = marked.parse(markdownContent);

        function resetZoom() {
            const diagram = document.querySelector('.mermaid svg');
            if (diagram) {
                diagram.style.transform = 'scale(1)';
            }
        }

        function toggleDiagram() {
            const container = document.getElementById('diagram-container');
            container.style.display = container.style.display === 'none' ? 'block' : 'none';
        }
    </script>
</body>
</html>